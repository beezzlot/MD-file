# Лабораторная работа №4. Тема: "Проверка операционной системы на уязвимости. Основные инструменты"
Цель работы
----------

познакомиться с основными инструментами проверки ОС на уязвимость. 


Оборудование, ПО:
----------
Виртуальная машина под управлением ОС Astra Linux 1.7  в режиме защищенности "Воронеж".


Ход работы:
----------
В ходе выполнения лабораторной работы мы рассмотрим  основные бесплатные инструменты и методы для проверки безопасности операционной системы, научимся анализировать результаты сканирования и принимать необходимые меры для защиты своей системы. 


# Для начала разберем пару основных терминов, которые напрямую касаются темы уязвимостей

Существуют базы данных общеизвестных уязвимостей, самая популярная из них - [CVE MITRE](https://www.cve.org/). Когда исследователи находят уязвимости в определенных информационных продуктах, они предупреждают компанию о найденной уязвимости, дают время на исправление уязвимости и иногда через какое-то время публикуют результаты исследования. Каждой такой уязвимости присваивается ID. В ID записывается год обнаружения уязвимостей и порядковый номер. Например, [CVE-2024-0754](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-0754) - уязвимость в Mozilla Firefox. кроме ID каждая запись в базе CVE содержит:

1. Краткое описание уязвимости;

2. Ссылки на сторонние ресурсы, где подтверждается данная уязвимость;

3. Дата обнаружения уязвимости.

CVE MITRE - международная некоммерческая организация, специализирующаяся в области информационной безопаности и исследований информационных технологий в интересах органов государственной власти США. 

В России же аналогичными разработками и учетом уязвимостей занимется ФСТЭК и ГосСОПКА (ГосСОПКА - государственная система обнаружения, предупреждения и ликвидации последствий компьютерных атак). [Банк данных угроз безопасности информации ФСТЭК РФ](https://bdu.fstec.ru/vul)

Уязвимости, о которых еще не знают разработчики продукта, называют 0-day(уязвимости нулевого дня) уязвимостями. Они идеальны для проведения атак, так как на момент их обнаружения исследователями или злоумышленником практически нет возможности от них защититься. С другой стороны, поиск 0-day уязвимостей - очень сложный процесс и требует высокого уровня подготовки.

Также возникают ситуации, когда разработчики сами находят уязвимости в своих продуктах и исправляют ее в новом патче, а исследователи, анализируя внесенные изменения, находят место, в котором была исправлена уязвимость и самостоятельно разрабатывают эксплоит. Такие эксплоиты называют 1-day. Они также представляют большую опасность, потому что многие пользователи вовремя не обновляют свое программное обеспечение.


# Начнем с LINPEAS


LINPEAS-suite (Linux-Privilege Escalation Awesome Scripts Suite) - это набор скриптов, предназначенных для автоматизации процесса поиска привилегий и повышения прав в операционных системах Linux. Этот инструмент позволяет искать уязвимости, которые могут быть использованы для получения повышенных привилегий на целевой системе. LINPEAS-suite включает в себя различные скрипты и инструменты, которые помогают исследователям безопасности и специалистам по информационной безопасности обнаруживать и эксплуатировать уязвимости в операционных системах. Этот набор скриптов может быть использован как в обучающих целях, так и для проведения тестов на проникновение или аудита безопасности.

## Как его запустить? 

Если на целевой системе присутствует утилита curl

```
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh
```

Если на целевой системе присутствует утилита wget

```
wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh; sh linpeas.sh
```

В Astra Linux, по умолчанию, есть обе команды. Введем одну из них и посмотрим вывод работы скрипта.

![Картинка](Screen1.png)

Внимательно осмотрите легенду скрипта. Это поможет понять на что стоит обращать внимание.

![Картинка](Screen2.png)

Если не пользоваться дополнительными ключами, то скрипт выполняет полное сканирование вашей локальной машины и находит: 

1. Уязвимое ПО;

2. Неаккуратно настроенные права sudo;

3. Полные сведения о операционной системе;

4. Где располагается сервер (в случае, если этот сервер находится на виртуальном хостинге или облачном провайдере);

5. Запущенные процессы и их уязвимое место;

6. Сканирует crontab и systemd-timers, изучая какие процессы были автоматизированы данным таймером;

7. Активные порты и основные сетевые реквизиты;

8. Доступные интерпретаторы; 

![Картинка](Screen3.png)

9. Если скрипт находит сервис, к которому есть известные уязвимости, он попытается их проэксплуатировать. Так, например, на ваших виртуальных машинах установлена база данных PostgreSQL;

![Картинка](Screen4.png)

И вот результат! Скрипт показал нам основные сведения о PostgreSQL, а также выполнил попытку подключения к базе данных без пароля (предполагая, что администраторы могли забыть или умышленно оставить локальный доступ к БД без пароля);

10. Файлы с неправильными или "интересными" правами доступа. А также вероятные уязвимости этих файлов из реестра;

![Картинка](Screen5.png)

11. Поиск "оставленных" паролоей по всей системе;

![Картинка](Screen6.png)

12. И многое-многое другое. Ознакомиться с "чеклистом этичного хакера" можно [тут](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md#checklists)

# А что есть еще? 

На самом деле выбор утилит большой, например можно использовать: 

1. OpenVas.

2. Tenable Nessus.

3. Gobysec / Goby.

4. Tsunami-security-scanner.

5. Flan Scan.

6. D9scan.

7. Rustscan.

8. Owasp ZAP.

9. W9Scan.

10. Nmap.
 
Но многие перечисленные инструменты либо платные или проверяют уязвимости сервисов, а не самих ОС (как допустим OWASP), либо используют "обвязки" над NMAP для упрощения его использования, поэтому обратимся сразу к первоисточнику. 

nmap (https://nmap.org/). Nmap («Network Mapper») — это инструмент с открытым исходным кодом для исследования сети, аудита безопасности, определения версий ОС, различных сервисов и многого другого. Не стоит забывать и о скриптовом движке NSE. NSE (Nmap Scripting Engine) является компонентом Nmap, который позволяет писать скрипты и автоматизировать часть задач, например, обнаружения и/или эксплуатации уязвимостей.

nmap доступен из стандартных репозиториев Astra Linux и может быть установлен командой - 

```
sudo apt install nmap
```

И попробуем отсканировать свой localhost - 127.0.0.1

```
sudo nmap -p- -sV --script=vuln 127.0.0.1
```

В ответ мы получим подробный список всех открытых портов на нашем сервере, а также какие уязвимости, вероятно, применимые к данному ПО.

![Картинка](Screen7.png)

Также, можно воспользоваться Community версией скрипта vuln, под названием - vulscan. Установить её можно следующими командам: 

Первым делом установите git. Он пригодится нам для клонирования репозитория с vulscan.

```
apt install git
```

Далее перейдите в каталог scripts, где NMAP располагает все скрипты.

```
cd /usr/share/nmap/scripts/
```

Скопируйте репзиторий vulscan на свой компьютер, в каталог /usr/share/nmap/scripts/

```
git clone https://github.com/scipag/vulscan.git
```

А затем создайте символьную ссылку, для того чтобы добавить новый скрипт в базу данных NMAP

```
ln -s `pwd`/scipag_vulscan /usr/share/nmap/scripts/vulscan 
```

В каталоге  /usr/share/nmap/scripts/vulscan/utilities/updater/ можно найти скрипт - **updateFiles.sh**. Он автоматически выполняет обновление информационной базы уязвимостей. Его можно использовать периодически для обновления. 

Использовать новый скрипт можно так - 

```
nmap -sV --script vulscan 127.0.0.1
```

Вывод команды такой же по формату, но немного больше по списку вероятных уязвимостей. 


# А есть что-то от ФСТЭК или ГосСОПКИ? 

И такое есть, называется ScanOVAL. Доступен как для [Windows](https://bdu.fstec.ru/scanoval) так и для [Linux](https://bdu.fstec.ru/scanovalforlinux) (Astra Linux, Alt Linux и РОСА Linux) 

Установить программу ScanOVAL для Astra Linux 1.7 можно по инструкции - Руководство оператора [Ссылка](https://bdu.fstec.ru/files/documents/scanovalforlinux_alse17_manual.pdf)

Программа не требует выхода в интернет, но требует обновления OVAL-файлов, которые необходимо устанавливать самостоятельно. 

В интерфейсе можно ознакомиться со всеми зарегестрированными уязвимостями

![Картинка](Screen8.png)

А также запустить сканер уязвимостей, для того чтобы найти их на вашем рабочем месте. 

![Картинка](Screen9.png)


Вывод работы сканера -

![Картинка](Screen10.png)



# Практическая работа

1. Выполните аудит вашей системы через linpeas.sh. 

      *  Вывод работы linpeash.sh выведите в /opt/linpeas.txt;

2. Выполните сканирование через ScanOVAL. 






# Дополнительная информация:
1) Руководство по NSE [Ссылка](https://networkguru.ru/nmap-scripting-engine-rukovodstvo/)


